---
title: "R_markdown_day_6"
author: "Rammah Elnour"
date: "22/09/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

**Day 5**

```{r}
## Creating a script for group 4 task ##

## Loading necessary packages ##
library(tidyverse)
library(here)

#Day 5----

##Loading data----
Group_4_data <- read_delim(here("data", "exam_nontidy - copy.txt"), delim = "\t")

##Separate columns----
Group_4_data <- 
  Group_4_data %>%
  separate(col = `pregnancy_num-age`,
           into = c("pregnancy_num", "age"),
           sep = "-")

##separate hospital and subject
Group_4_data <- 
  Group_4_data %>%
  separate(col = subject,
           into = c("hospital", "subject"),
           sep = "-")

## Removing duplicates----
Group_4_data <-
  Group_4_data %>%
  distinct()

##Change column names that contain spaces or start with numbers (or characters?)----
Group_4_data <- 
  Group_4_data %>% 
  rename(id = `subject`,
         insulin_microiu_ml = `insulin microiu ml`,
         diabetes_5y = `5y diabetes`,
         measured_variable = `measured variable`,
         value = `.value`
  )

## Pivoting columns with values from various measurements----
Group_4_data <- Group_4_data %>% 
  pivot_wider(names_from = "measured_variable",
              values_from = "value")
```


**Day 6**

```{r, echo=TRUE, eval=FALSE}
#Working with Tidyverse to tidy, adjust, and explore the data set

## Remove  columns from the dataframe: choleste, sibling ----
Group_4_data <- 
  Group_4_data %>% 
  select(-c(sibling, choleste))

## Change variable type ----
Group_4_data <- 
  Group_4_data %>%
  mutate(pregnancy_num = as.numeric(pregnancy_num),
         age = as.numeric(age),
         id = as.numeric(id))

## Create set of columns for: glucose_mg_dl>120, insulin in units pmol/L ----
## diabetes_5y as 0/1, multiplication of age and pregnancy_num
Group_4_data <-
  Group_4_data %>% 
  mutate(glucose_mg_dl_classifier = if_else(glucose_mg_dl >= 120, "High", "Low")) %>% 
  mutate(insulin_microiu_pmol_l = insulin_microiu_ml*6.945) %>% 
  mutate(diabetes_5y_classifier = if_else(diabetes_5y == "pos", "1","0")) %>% 
  mutate(multiply_age_pregnancy = age*pregnancy_num) %>% 
  select(id,hospital,age,everything()) %>% 
  arrange(id)

##Read and join additional dataset to your main dataset----
Joining_data <- read_delim(here("data", "exam_joindata - copy.txt"), delim = "\t")

##Join datasets----
Group_4_joined_data <-
  Group_4_data %>%
  left_join(Joining_data, by = "id")


##Explore data again after adjustments ----
summary(Group_4_joined_data)
glimpse(Group_4_joined_data)
skimr::skim(Group_4_joined_data)
naniar::gg_miss_var(Group_4_joined_data)
naniar::gg_miss_var(Group_4_joined_data, facet = glucose_mg_dl_classifier)

##Comment on missing data?----
#the analysis of missing data shows that the antibody, serum insulin, and triceps measurements are missing the most values. 

#when stratifying for diabetes it would appear that these measurements are missing mainly for people that were not diagnosed with diabetes in the following 5 years this makes sense as diagnosis of diabetes would result in further testing and more measurements including insulin and subcutaneous fat and therefore less missing values.

#similarly when stratifying for high and low glucose values, the most missing values exist for the people with low glucose values, as they probably do not need to get tested as much for insulin and subcutaneous fat. 


##Stratify data by BMI and report: min,max,mean,sd----
Group_4_joined_data %>% 
  group_by(glucose_mg_dl_classifier) %>% 
  summarise(max(bmi, na.rm = T), min(bmi, na.rm = T), mean(bmi, na.rm = T), 
            sd(bmi, na.rm = T))

##Stratify data by specific categorical column: min,max,mean,sd----

Group_4_joined_data %>% 
  group_by(glucose_mg_dl_classifier) %>% 
  filter(diabetes_5y == "pos") %>% 
  filter(hospital == "Hosp1") %>% 
  filter(pregnancy_num > 2) %>% 
  filter(glucose_mg_dl < 120 & glucose_mg_dl > 60) %>% 
  summarise(max(dbp_mm_hg, na.rm = T), min(dbp_mm_hg, na.rm = T), mean(dbp_mm_hg, na.rm = T), 
            sd(dbp_mm_hg, na.rm = T))
  
```

**Day 7**

```{r, echo=TRUE, eval=FALSE}
##Glucose and insulin----
##Does the level of glucose and insulin depend on each other?
Glucose_insulin_plot <-
  ggplot(Group_4_joined_data) +
  aes(x = glucose_mg_dl,
      y = insulin_microiu_pmol_l) +
  geom_point() +
  xlab("Glucose level (mg/dL)") +
  ylab("Insulin microIU/mL") +
  labs(title = "Glucose and insulin at 2 hours",
       caption = "data source: Diabetes Prediction Dataset from the Pima Indian Tribe and the NIDDK")
Glucose_insulin_plot

# The plot illustrates the relationship between plasma glucose concentration serum insulin at 2 hours after administration of an oral glucose tolerance test. Visually, there seems to appear a tendency toward a higher insulin level with higher glucose level. There are many missing values for insulin (375 out of 768), which could lead to a skewed outcome.

##Stratify diabetes and check Glucose and insulin----
##Does the level of glucose and insulin depend on each other, when stratifying by outcome (diabetes_5y)?
Glucose_insulin_plot_stratified <-
  ggplot(Group_4_joined_data) +
  aes(x = glucose_mg_dl,
      y = insulin_microiu_pmol_l) +
  geom_point() +
  facet_wrap(facets = vars(diabetes_5y_classifier)) +
  geom_smooth(method = "lm") +
  xlab("Glucose level (mg/dL)") +
  ylab("Insulin microIU/mL") +
  labs(title = "Glucose and insulin at 2 hours",
       caption = "data source: Diabetes Prediction Dataset from the Pima Indian Tribe and the NIDDK")
Glucose_insulin_plot_stratified

#As without the stratification, there is a tendency to higher insulin with higher glucose. However, there are fewer observations for those with diabetes vs those without, which makes the results for those with diabetes less reliable.


## Glucose and blood pressure----
## Does the level of glucose and blood pressure depend on each other?
glucose_bp <-
  ggplot(Group_4_joined_data) +
  aes(x = glucose_mg_dl,
      y = dbp_mm_hg) +
  geom_point() +
  xlab("Glucose level (mg/dl)") +
  ylab("Blood pressure (mm/hg)") +
  labs(title = "Relationship between glucose level and blood pressure",
       caption = "data source: Diabetes Prediction Dataset from the Pima Indian Tribe and the NIDDK")
glucose_bp
# Visually, it does not look like there is a relationship between level of glucose and blood pressure

##BMI and triceps_mm values association----
bmi_triceps_plot <- Group_4_joined_data %>% 
  filter(triceps_mm < 90) %>% 
  ggplot(aes(x = bmi,
             y = triceps_mm)) +
  geom_point() +
  geom_smooth(method = lm,
              se = T) +
  labs(x = "bmi (kg/m2)",
       y = "triceps (mm)",
       title = "Relationship between bmi and triceps skin fold thickness") +
  theme_minimal()
bmi_triceps_plot

#This plot demonstrates that there appears to be a correlation between BMI and
#subcutaneous fat, as measured by triceps skin fold thickness. 


##Distribution of blood pressure between BMI----
##Is the blood pressure distribution different between these BMI categories?
Bloodpressure_BMI <- vector(mode ="character", length(Group_4_joined_data$bmi))
Bloodpressure_BMI[Group_4_joined_data$bmi<25] <- "BMI < 25"
Bloodpressure_BMI[Group_4_joined_data$bmi >= 25 &
                    Group_4_joined_data$bmi < 30] <- "25 <= BMI < 30"
Bloodpressure_BMI[Group_4_joined_data$bmi>=30] <- "30 <= BMI"

Group_4_joined_data$Bloodpressure_BMI <- Bloodpressure_BMI

ggplot(Group_4_joined_data) +
  aes(x = Bloodpressure_BMI,
      y = dbp_mm_hg
  ) +
  geom_boxplot()
ylab("bmi") +
  xlab("dbp_mm_hg") 

```
### Day 8
The primary analysis task is to classify in each participant whether diabetes developed within 5 years of data collection.In this final section, we have explored several possible correlations within the dataset.  
\

#### Does the outcome depend on hospital? Explored by performing an anova test.

```{r, echo=FALSE, eval=TRUE}
  Group_4_joined_data %>% 
  aov(diabetes_5y_classifier~hospital, data = .) %>%
  broom::tidy()

```
*The anova test yields a p-value of 0.298, which indicates that the outcome does not depend on hospital.*
\
\

#### Does the outcome depend on pedigree? Explored by performing a t-test.

```{r, echo=FALSE, eval=TRUE}
Group_4_joined_data %>%
  t.test(pedigree~diabetes_5y_classifier, data = .) %>%
  broom::tidy()

```
*The p-value is 0.00006, so the outcome depends on pedigree. With higher pedigree score, it is more likely to develop diabetes within 5 years.*
\
\

#### Does the outcome depend on BMI? Visualized in a box plot, and explored in a t-test.
\
**Box plot**  
```{r, echo=FALSE, eval=TRUE}
diabetes_pedigree_plot <-
  ggplot(Group_4_joined_data) +
  aes(x = diabetes_5y_classifier, y = pedigree) +
  geom_boxplot() +
  xlab("Diabetes after 5 years") +
  ylab("Pedigree") +
  labs(title = "Relationship between diabetes outcome and pedigree score",
       caption = "data source: Diabetes Prediction Dataset from the Pima Indian Tribe and the NIDDK")
diabetes_pedigree_plot  
```
\
**T-test**
```{r,echo=FALSE, eval=TRUE}
Group_4_joined_data %>%
  t.test(bmi~diabetes_5y_classifier, data = .) %>%
  broom::tidy()
```
\
*The p-value is 2.48e-18, so yes, the outcome depends on bmi. With higher bmi, it is more likely to develop diabetes within 5 years.*
